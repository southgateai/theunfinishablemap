{{ define "main" }}
<section class="api-index">
    <h1>{{ .Title }}</h1>

    {{ with .Description }}
    <p>{{ . }}</p>
    {{ end }}

    <div class="api-info">
        <p>This is the machine-readable API section. Content here is optimized for AI chatbots and automated systems.</p>
        <p>Each page includes JSON-LD structured data and a <code>#page-data</code> JSON block for programmatic access.</p>
    </div>

    <h2>Available Content</h2>
    <ul class="api-list">
    {{ range .Pages }}
        {{- $ai := .Params.ai_contribution | default 0 -}}
        {{- $type := cond (eq $ai 0) "human" (cond (eq $ai 100) "ai" "mixed") -}}
        <li itemscope itemtype="https://schema.org/Article">
            <a href="{{ .RelPermalink }}" itemprop="url">
                <span itemprop="name">{{ .Title }}</span>
            </a>
            <span class="authorship-type" data-type="{{ $type }}">
                [{{ $type }}{{ if and (ne $ai 0) (ne $ai 100) }}: {{ $ai }}%{{ end }}]
            </span>
            <meta itemprop="datePublished" content="{{ .Date.Format "2006-01-02" }}">
        </li>
    {{ end }}
    </ul>

    <!-- Index JSON for programmatic access -->
    <script type="application/json" id="index-data">
    {
        "section": "{{ .Title }}",
        "count": {{ len .Pages }},
        "pages": [
            {{ range $i, $p := .Pages }}
            {{- $ai := $p.Params.ai_contribution | default 0 -}}
            {{- $type := cond (eq $ai 0) "human" (cond (eq $ai 100) "ai" "mixed") -}}
            {{ if $i }},{{ end }}
            {
                "title": "{{ $p.Title }}",
                "url": "{{ $p.Permalink }}",
                "date": "{{ $p.Date.Format "2006-01-02" }}",
                "authorship_type": "{{ $type }}",
                "ai_contribution": {{ $ai }}
            }
            {{ end }}
        ]
    }
    </script>
</section>
{{ end }}
