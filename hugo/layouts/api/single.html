{{ define "main" }}
<article itemscope itemtype="https://schema.org/Article" class="api-content">
    <header>
        <h1 itemprop="name">{{ .Title }}</h1>
        <meta itemprop="datePublished" content="{{ .Date.Format "2006-01-02" }}">
        <meta itemprop="dateModified" content="{{ .Lastmod.Format "2006-01-02" }}">
    </header>

    {{ with .Params.authorship }}
    <div class="authorship-metadata" itemprop="author" itemscope itemtype="https://schema.org/{{ if eq .type "ai" }}Organization{{ else }}Person{{ end }}">
        <span itemprop="name">
            {{ if eq .type "ai" }}
                {{ with .ai_system }}{{ . }}{{ else }}AI System{{ end }}
            {{ else if eq .type "human" }}
                {{ with .human_contributors }}{{ (index . 0).name }}{{ end }}
            {{ else }}
                Mixed ({{ with .ai_contribution }}{{ . }}{{ else }}50{{ end }}% AI)
            {{ end }}
        </span>
        <meta itemprop="authorType" content="{{ .type }}">
        {{ with .ai_contribution }}<meta itemprop="aiContribution" content="{{ . }}">{{ end }}
    </div>
    {{ end }}

    <div itemprop="articleBody" class="content">
        {{ .Content }}
    </div>

    {{ with .Params.structured_data }}
    <footer class="structured-data">
        {{ with .concepts }}
        <div class="concepts">
            <strong>Concepts:</strong>
            <ul itemprop="keywords">
                {{ range . }}
                <li><a href="/api/concepts/{{ . | urlize }}/" itemprop="keyword">{{ . }}</a></li>
                {{ end }}
            </ul>
        </div>
        {{ end }}

        {{ with .related_articles }}
        <div class="related">
            <strong>Related:</strong>
            <ul>
                {{ range . }}
                <li><a href="{{ . }}">{{ . }}</a></li>
                {{ end }}
            </ul>
        </div>
        {{ end }}
    </footer>
    {{ end }}
</article>

<!-- Raw JSON for programmatic access -->
<script type="application/json" id="page-data">
{
    "title": "{{ .Title }}",
    "url": "{{ .Permalink }}",
    "date": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    "lastmod": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    {{ with .Params.authorship }}
    "authorship": {
        "type": "{{ .type }}",
        {{ with .ai_contribution }}"ai_contribution": {{ . }},{{ end }}
        {{ with .ai_system }}"ai_system": "{{ . }}",{{ end }}
        {{ with .human_contributors }}"human_contributors": [{{ range $i, $c := . }}{{ if $i }},{{ end }}{"name": "{{ $c.name }}", "role": "{{ $c.role }}"}{{ end }}],{{ end }}
        {{ with .last_curated }}"last_curated": "{{ . }}"{{ end }}
    },
    {{ end }}
    {{ with .Params.structured_data }}
    "structured_data": {
        {{ with .concepts }}"concepts": [{{ range $i, $c := . }}{{ if $i }},{{ end }}"{{ $c }}"{{ end }}],{{ end }}
        {{ with .related_articles }}"related_articles": [{{ range $i, $a := . }}{{ if $i }},{{ end }}"{{ $a }}"{{ end }}]{{ end }}
    },
    {{ end }}
    "content_length": {{ len .Content }}
}
</script>
{{ end }}
