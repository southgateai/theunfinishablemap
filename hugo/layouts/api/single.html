{{ define "main" }}
{{- $ai := .Params.ai_contribution | default 0 -}}
{{- $type := cond (eq $ai 0) "human" (cond (eq $ai 100) "ai" "mixed") -}}
<article itemscope itemtype="https://schema.org/Article" class="api-content">
    <header>
        <h1 itemprop="name">{{ .Title }}</h1>
        <meta itemprop="datePublished" content="{{ .Date.Format "2006-01-02" }}">
        <meta itemprop="dateModified" content="{{ .Lastmod.Format "2006-01-02" }}">
    </header>

    <div class="authorship-metadata" itemprop="author" itemscope itemtype="https://schema.org/{{ if eq $type "ai" }}Organization{{ else }}Person{{ end }}">
        <span itemprop="name">
            {{ if eq $type "ai" }}
                {{ with .Params.ai_system }}{{ . }}{{ else }}AI System{{ end }}
            {{ else if eq $type "human" }}
                {{ with .Params.author }}{{ . }}{{ else }}Unknown{{ end }}
            {{ else }}
                Mixed ({{ $ai }}% AI)
            {{ end }}
        </span>
        <meta itemprop="authorType" content="{{ $type }}">
        {{ if $ai }}<meta itemprop="aiContribution" content="{{ $ai }}">{{ end }}
    </div>

    <div itemprop="articleBody" class="content">
        {{ .Content }}
    </div>

    <footer class="structured-data">
        {{ with .Params.concepts }}
        <div class="concepts">
            <strong>Concepts:</strong>
            <ul itemprop="keywords">
                {{ range . }}
                <li><a href="/api/concepts/{{ . | urlize }}/" itemprop="keyword">{{ . }}</a></li>
                {{ end }}
            </ul>
        </div>
        {{ end }}

        {{ with .Params.related_articles }}
        <div class="related">
            <strong>Related:</strong>
            <ul>
                {{ range . }}
                <li><a href="{{ . }}">{{ . }}</a></li>
                {{ end }}
            </ul>
        </div>
        {{ end }}
    </footer>
</article>

<!-- Raw JSON for programmatic access -->
<script type="application/json" id="page-data">
{
    "title": "{{ .Title }}",
    "url": "{{ .Permalink }}",
    "date": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    "lastmod": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    "ai_contribution": {{ $ai }},
    {{ with .Params.author }}"author": "{{ . }}",{{ end }}
    {{ with .Params.ai_system }}"ai_system": "{{ . }}",{{ end }}
    {{ with .Params.last_curated }}"last_curated": "{{ . }}",{{ end }}
    {{ with .Params.concepts }}"concepts": [{{ range $i, $c := . }}{{ if $i }},{{ end }}"{{ $c }}"{{ end }}],{{ end }}
    {{ with .Params.related_articles }}"related_articles": [{{ range $i, $a := . }}{{ if $i }},{{ end }}"{{ $a }}"{{ end }}],{{ end }}
    "content_length": {{ len .Content }}
}
</script>
{{ end }}
